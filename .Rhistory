red_oc <- data %>% filter(fdr_pval_o < 0.05)
red_ex <- data %>% filter(fdr_pval_e < 0.05)
# grafo no firigido
red_oc <- graph_from_data_frame(
d = red_oc %>% select(Mags, Bgcs),
directed = FALSE
)
red_ex <- graph_from_data_frame(
d = red_ex %>% select(Mags, Bgcs),
directed = FALSE
)
# calcular grado de cada nodo
V(red_oc)$grado <- degree(red_oc)
V(red_ex)$grado <- degree(red_ex)
# graficar
plot_oc <- ggraph(red_oc, layout = "fr", niter = 1000) +
geom_edge_link(color = "steelblue", width = 0.8, alpha = 0.5) +
geom_node_point(aes(size = grado), color = "darkblue", alpha = 0.9) +
geom_node_text(
aes(label = ifelse(grado > grado_min, name, "")),
repel = TRUE, size = 3, max.overlaps = 100
) +
theme_void() +
ggtitle("Red de co-ocurrencia")
ggraph(red_ex, layout = "fr") +
geom_edge_link(color = "tomato", width = 0.8) +
geom_node_point(aes(size = grado), color = "pink") +
geom_node_text(aes(label = name), repel = TRUE, size = 3) +
theme_void() +
ggtitle("Red de co-exclusion")
# devolver lista
return(list(
red_oc = red_oc,
red_ex = red_ex,
plot_oc = plot_oc,
plot_ex = plot_ex
))
}
# obtener la cantidad de interacciones por nodo en una tabla
resultado <- ntwk_graph(gen_gcf, grado_min = 100)
ntwk_graph <- function(data, grado_min = 100) {
# separar los casos significativos
red_oc <- data %>% filter(fdr_pval_o < 0.05)
red_ex <- data %>% filter(fdr_pval_e < 0.05)
# grafo no firigido
red_oc <- graph_from_data_frame(
d = red_oc %>% select(Mags, Bgcs),
directed = FALSE
)
red_ex <- graph_from_data_frame(
d = red_ex %>% select(Mags, Bgcs),
directed = FALSE
)
# calcular grado de cada nodo
V(red_oc)$grado <- degree(red_oc)
V(red_ex)$grado <- degree(red_ex)
# graficar
plot_oc <- ggraph(red_oc, layout = "fr", niter = 1000) +
geom_edge_link(color = "steelblue", width = 0.8, alpha = 0.5) +
geom_node_point(aes(size = grado), color = "darkblue", alpha = 0.9) +
geom_node_text(
aes(label = ifelse(grado > grado_min, name, "")),
repel = TRUE, size = 3, max.overlaps = 100
) +
theme_void() +
ggtitle("Red de co-ocurrencia")
plot_ex <- ggraph(red_ex, layout = "fr") +
geom_edge_link(color = "tomato", width = 0.8) +
geom_node_point(aes(size = grado), color = "pink") +
geom_node_text(aes(label = name), repel = TRUE, size = 3) +
theme_void() +
ggtitle("Red de co-exclusion")
# devolver lista
return(list(
red_oc = red_oc,
red_ex = red_ex,
plot_oc = plot_oc,
plot_ex = plot_ex
))
}
# obtener la cantidad de interacciones por nodo en una tabla
resultado <- ntwk_graph(gen_gcf, grado_min = 100)
resultado$plot_ex
resultado$plot_oc
resultado$red_ex
view(resultado$red_ex)
View(resultado$red_ex)
# grado de los nodos en tabla para graficar
grado_nodos <- gen_gcf %>%
# Contar apariciones de cada MAG
count(Mags, name = "grado") %>%
rename(nodo = Mags) %>%
bind_rows(
# Contar apariciones de cada BGC
red_df %>%
count(Bgcs, name = "grado") %>%
rename(nodo = Bgcs)
) %>%
group_by(nodo) %>%
summarise(grado = sum(grado)) %>%
arrange(desc(grado))
# grado de los nodos en tabla para graficar
grado_nodos <- gen_gcf %>%
# Contar apariciones de cada MAG
count(Mags, name = "grado") %>%
rename(nodo = Mags) %>%
bind_rows(
# Contar apariciones de cada BGC
gen_gcf %>%
count(Bgcs, name = "grado") %>%
rename(nodo = Bgcs)
) %>%
group_by(nodo) %>%
summarise(grado = sum(grado)) %>%
arrange(desc(grado))
View(grado_nodos)
# grado de los nodos en tabla para graficar
grado_mags <- gen_gcf %>%
count(Mags, name = "grado") %>%   # cuenta cuántas veces aparece cada MAG
rename(nodo = Mags) %>%
arrange(desc(grado)) %>%
mutate(tipo = "MAG")
View(grado_mags)
gc()
library(tidyverse)
library(ggplot2)
library(patchwork)
plot_pvalues <- function(cases, mag_group, bgc_group) {
p_exclusion <- ggplot(cases, aes(x = pvalue_e)) +
geom_histogram(binwidth = 0.05, fill = "darkblue") +
labs(
title = paste("Co-exclusion of", mag_group, "and", bgc_group),
x = "p-value",
y = "Frequency"
) +
theme_minimal()
p_occurrence <- ggplot(cases, aes(x = pvalue_o)) +
geom_histogram(binwidth = 0.05, fill = "steelblue") +
labs(
title = paste("Co-occurrence of", mag_group, "and", bgc_group),
x = "p-value",
y = "Frequency"
) +
theme_minimal()
list(p_exclusion, p_occurrence)
}
motu_gcf <- read.csv(file = '~/2025-interacions/motu_gcf/all_cases.csv', header = TRUE)
motu_gcc <- read.csv(file = '~/2025-interacions/motu_gcc/all_cases.csv', header = TRUE)
fam_gcf <- read.csv(file = '~/2025-interacions/fam_gcf/all_cases.csv', header = TRUE)
fam_gcc <- read.csv(file = '~/2025-interacions/fam_gcc/all_cases.csv', header = TRUE)
gen_gcf <- read.csv(file = '~/2025-interacions/gen_gcf/all_cases.csv', header = TRUE)
gen_gcc <- read.csv(file = '~/2025-interacions/gen_gcc/all_cases.csv', header = TRUE)
# create the plots
plots <- list(
plot_pvalues(motu_gcc, 'mOTUs', 'GCCs')
)
# flat the list of lists
plots_flat <- do.call(c, plots)
# paste in only one graph
p_final <- wrap_plots(plots_flat, ncol = 2, nrow = 1) +
plot_annotation(title = "Distribución de p-values")
p_final
setwd("~/MAGs_BGCs_interactions")
meta_mags <- read.csv("metadata.csv")
meta_bgcs <- read.csv("bgcs_metadata.csv")
ggsave("dist_pvalues.png", plot = p_final, width = 20.3, height = 7, units = "in")
ggsave("dist_pvalues.png", plot = p_final, width = 20.3, height = 6, units = "in")
plot_pvalues <- function(cases, mag_group, bgc_group) {
p_exclusion <- ggplot(cases, aes(x = pvalue_e)) +
geom_histogram(binwidth = 0.05, fill = "darkblue") +
labs(
title = paste("Co-exclusion of", mag_group, "and", bgc_group),
x = "p-value",
y = "Frequency"
) +
theme_minimal() +
theme(
legend.position = "none",
axis.text.x = element_text(size = 18),  # Tamaño del texto de los números del eje x
axis.title.x = element_text(size = 18)# Tamaño de la etiqueta del eje y
)
p_occurrence <- ggplot(cases, aes(x = pvalue_o)) +
geom_histogram(binwidth = 0.05, fill = "steelblue") +
labs(
title = paste("Co-occurrence of", mag_group, "and", bgc_group),
x = "p-value",
y = "Frequency"
) +
theme_minimal() +
theme(
legend.position = "none",
axis.text.x = element_text(size = 18),  # Tamaño del texto de los números del eje x
axis.title.x = element_text(size = 18)# Tamaño de la etiqueta del eje y
)
list(p_exclusion, p_occurrence)
}
# create the plots
plots <- list(
plot_pvalues(motu_gcc, 'mOTUs', 'GCCs')
)
# flat the list of lists
plots_flat <- do.call(c, plots)
# paste in only one graph
p_final <- wrap_plots(plots_flat, ncol = 2, nrow = 1) +
plot_annotation(title = "Distribución de p-values")
ggsave("dist_pvalues.png", plot = p_final, width = 20.3, height = 6, units = "in")
p_final
ggsave("dist_pvalues.png", plot = p_final, bg = "transparent" ,width = 20.3, height = 6, units = "in")
ggsave("dist_pvalues1.png", plot = p_final, bg = "transparent" ,width = 20.3, height = 6, units = "in")
plot_pvalues <- function(cases, mag_group, bgc_group) {
p_exclusion <- ggplot(cases, aes(x = pvalue_e)) +
geom_histogram(binwidth = 0.05, fill = "darkblue") +
labs(
title = paste("Co-exclusion of", mag_group, "and", bgc_group),
x = "p-value",
y = "Frequency"
) +
theme_void() +
theme(
legend.position = "none",
axis.text.x = element_text(size = 18),  # Tamaño del texto de los números del eje x
axis.title.x = element_text(size = 18)# Tamaño de la etiqueta del eje y
)
p_occurrence <- ggplot(cases, aes(x = pvalue_o)) +
geom_histogram(binwidth = 0.05, fill = "steelblue") +
labs(
title = paste("Co-occurrence of", mag_group, "and", bgc_group),
x = "p-value",
y = "Frequency"
) +
theme_void() +
theme(
legend.position = "none",
axis.text.x = element_text(size = 18),  # Tamaño del texto de los números del eje x
axis.title.x = element_text(size = 18)# Tamaño de la etiqueta del eje y
)
list(p_exclusion, p_occurrence)
}
# create the plots
plots <- list(
plot_pvalues(motu_gcc, 'mOTUs', 'GCCs')
)
# flat the list of lists
plots_flat <- do.call(c, plots)
# paste in only one graph
p_final <- wrap_plots(plots_flat, ncol = 2, nrow = 1) +
plot_annotation(title = "Distribución de p-values")
ggsave("dist_pvalues1.png", plot = p_final ,width = 20.3, height = 6, units = "in")
ggsave("dist_pvalues1.png", plot = p_final, device = "png", bg = "transparent", type = "cairo", width = 20.3, height = 6, units = "in")
library(tidyverse)
library(terra)
library(dplyr)
setwd("/home/azermeno/")
# Bins and MAGs accessions from the mag
raw_access <- read_excel("41586_2022_4862_MOESM4_ESM.xlsx",
sheet = "Metagenomic Bins and MAGs acces")
setwd("~/MAGs_BGCs_interactions")
meta_mags <- read.csv("metadata.csv")
meta_bgcs <- read.csv("bgcs_metadata.csv")
stations <- meta_mags %>%
distinct(`depth layer`)
stations <- meta_mags %>%
distinct(depth_layer)
conteo_genomas_por_lugar <- meta_mags %>%
count(depth_layer, name = "num_genomas")
depth <- ggplot(conteo_genomas_por_lugar, aes(x = reorder(`depth layer`, num_genomas), y = num_genomas, fill = num_genomas)) +
geom_bar(stat = "identity") +
scale_y_log10() +
scale_fill_gradientn(
colors = c("black","#00008b","#4682b4", "#add8e6"), # Paleta de colores
values = scales::rescale(c(65, 1075, 4671, 20482))  # Ajusta el impacto de los colores
) +
labs(x = "Depth layer", y = "Number of MAGs", fill = "Number of MAGs") +
coord_flip() +
theme_minimal() +
theme(
legend.position = "none",
axis.text.x = element_text(size = 18),  # Tamaño del texto de los números del eje x
axis.title.x = element_text(size = 18)# Tamaño de la etiqueta del eje y
)
ggsave("depth_layers.png", plot = depth, width = 34, height = 18, units = "cm")
stations <- meta_mags %>%
distinct(depth_layer)
conteo_genomas_por_lugar <- meta_mags %>%
count(depth_layer, name = "num_genomas")
depth <- ggplot(conteo_genomas_por_lugar, aes(x = reorder(depth_layer, num_genomas), y = num_genomas, fill = num_genomas)) +
geom_bar(stat = "identity") +
scale_y_log10() +
scale_fill_gradientn(
colors = c("black","#00008b","#4682b4", "#add8e6"), # Paleta de colores
values = scales::rescale(c(65, 1075, 4671, 20482))  # Ajusta el impacto de los colores
) +
labs(x = "Depth layer", y = "Number of MAGs", fill = "Number of MAGs") +
coord_flip() +
theme_minimal() +
theme(
legend.position = "none",
axis.text.x = element_text(size = 18),  # Tamaño del texto de los números del eje x
axis.title.x = element_text(size = 18)# Tamaño de la etiqueta del eje y
)
ggsave("depth_layers.png", plot = depth, width = 34, height = 18, units = "cm")
depth
plot_pvalues <- function(cases, mag_group, bgc_group) {
p_exclusion <- ggplot(cases, aes(x = pvalue_e)) +
geom_histogram(binwidth = 0.05, fill = "darkblue") +
labs(
title = paste("Co-exclusion of", mag_group, "and", bgc_group),
x = "p-value",
y = "Frequency"
) +
theme_minimal() +
theme(
legend.position = "none",
axis.text.x = element_text(size = 18),  # Tamaño del texto de los números del eje x
axis.title.x = element_text(size = 18)# Tamaño de la etiqueta del eje y
)
p_occurrence <- ggplot(cases, aes(x = pvalue_o)) +
geom_histogram(binwidth = 0.05, fill = "steelblue") +
labs(
title = paste("Co-occurrence of", mag_group, "and", bgc_group),
x = "p-value",
y = "Frequency"
) +
theme_minimal() +
theme(
legend.position = "none",
axis.text.x = element_text(size = 18),  # Tamaño del texto de los números del eje x
axis.title.x = element_text(size = 18), # Tamaño de la etiqueta del eje y
panel.background = element_rect(fill = NA, color = NA),
plot.background = element_rect(fill = NA, color = NA)
)
list(p_exclusion, p_occurrence)
}
motu_gcc <- read.csv(file = '~/2025-interacions/motu_gcc/all_cases.csv', header = TRUE)
# create the plots
plots <- list(
plot_pvalues(motu_gcc, 'mOTUs', 'GCCs')
)
# flat the list of lists
plots_flat <- do.call(c, plots)
# paste in only one graph
p_final <- wrap_plots(plots_flat, ncol = 2, nrow = 1) +
plot_annotation(title = "Distribución de p-values")
ggsave("dist_pvalues1.png", plot = p_final, device = "png", bg = "transparent", width = 20.3, height = 6, units = "in")
library(ggplot)
plot_pvalues <- function(cases, mag_group, bgc_group) {
p_exclusion <- ggplot(cases, aes(x = pvalue_e)) +
geom_histogram(binwidth = 0.05, fill = "darkblue") +
labs(
title = paste("Co-exclusion of", mag_group, "and", bgc_group),
x = "p-value",
y = "Frequency"
) +
theme_minimal() +
theme(
legend.position = "none",
axis.text.x = element_text(size = 18),  # Tamaño del texto de los números del eje x
axis.title.x = element_text(size = 18),# Tamaño de la etiqueta del eje y
panel.background = element_rect(fill = NA, color = NA),
plot.background = element_rect(fill = NA, color = NA)
)
p_occurrence <- ggplot(cases, aes(x = pvalue_o)) +
geom_histogram(binwidth = 0.05, fill = "steelblue") +
labs(
title = paste("Co-occurrence of", mag_group, "and", bgc_group),
x = "p-value",
y = "Frequency"
) +
theme_minimal() +
theme(
legend.position = "none",
axis.text.x = element_text(size = 18),  # Tamaño del texto de los números del eje x
axis.title.x = element_text(size = 18), # Tamaño de la etiqueta del eje y
panel.background = element_rect(fill = NA, color = NA),
plot.background = element_rect(fill = NA, color = NA)
)
list(p_exclusion, p_occurrence)
}
# create the plots
plots <- list(
plot_pvalues(motu_gcc, 'mOTUs', 'GCCs')
)
# flat the list of lists
plots_flat <- do.call(c, plots)
# paste in only one graph
p_final <- wrap_plots(plots_flat, ncol = 2, nrow = 1) +
plot_annotation(title = "Distribución de p-values")
ggsave("dist_pvalues1.png", plot = p_final, device = "png", bg = "transparent", width = 20.3, height = 6, units = "in")
View(plots)
ggsave("/home/azermeno/dist_pvalues1.png", plot = p_final, device = "png", bg = "transparent", width = 20.3, height = 6, units = "in")
p_exclusion <- ggplot(motu_gcc, aes(x = pvalue_e)) +
geom_histogram(binwidth = 0.05, fill = "darkblue") +
labs(
title = paste("Co-exclusion of mOTUs and GCCs"),
x = "p-value",
y = "Frequency"
) +
theme_minimal() +
theme(
legend.position = "none",
axis.text.x = element_text(size = 18),  # Tamaño del texto de los números del eje x
axis.title.x = element_text(size = 18),# Tamaño de la etiqueta del eje y
panel.background = element_rect(fill = NA, color = NA),
plot.background = element_rect(fill = NA, color = NA)
)
p_exclusion
ggsave("/home/azermeno/dist_p_ex.png", plot = p_exclusion, device = "png", bg = "transparent", width = 20.3, height = 6, units = "in")
ggsave("/home/azermeno/dist_p_ex.png", plot = p_exclusion, device = "png", bg = "transparent", width = 18, height = 8, units = "in")
p_exclusion <- ggplot(motu_gcc, aes(x = pvalue_e)) +
geom_histogram(binwidth = 0.05, fill = "#044a88") +
labs(
title = paste("Co-exclusion of mOTUs and GCCs"),
x = "p-value",
y = "Frequency"
) +
theme_minimal() +
theme(
legend.position = "none",
axis.text.x = element_text(size = 18),  # Tamaño del texto de los números del eje x
axis.title.x = element_text(size = 18),# Tamaño de la etiqueta del eje y
panel.background = element_rect(fill = NA, color = NA),
plot.background = element_rect(fill = NA, color = NA)
)
ggsave("/home/azermeno/dist_p_ex.png", plot = p_exclusion, device = "png", bg = "transparent", width = 18, height = 8, units = "in")
ggsave("/home/azermeno/dist_p_ex.png", plot = p_exclusion, device = "png", bg = "transparent", width = 9, height = 4.5, units = "in")
p_ocurrence <- ggplot(motu_gcc, aes(x = pvalue_o)) +
geom_histogram(binwidth = 0.05, fill = "#b4d3e2") +
labs(
title = paste("Co-occurrence of mOTUs and GCCs"),
x = "p-value",
y = "Frequency"
) +
theme_minimal() +
theme(
legend.position = "none",
axis.text.x = element_text(size = 18),  # Tamaño del texto de los números del eje x
axis.title.x = element_text(size = 18),# Tamaño de la etiqueta del eje y
panel.background = element_rect(fill = NA, color = NA),
plot.background = element_rect(fill = NA, color = NA)
)
ggsave("/home/azermeno/dist_p_oc.png", plot = p_ocurrence, device = "png", bg = "transparent", width = 9, height = 4.5, units = "in")
p_ocurrence <- ggplot(motu_gcc, aes(x = pvalue_o)) +
geom_histogram(binwidth = 0.05, fill = "#b4d3e2") +
labs(
title = paste("Co-occurrence of mOTUs and GCCs"),
x = "p-value",
y = "Frequency"
) +
theme_minimal() +
theme(
legend.position = "none",
axis.title = element_text(size = 18),# Tamaño de la etiqueta del eje y
panel.background = element_rect(fill = NA, color = NA),
plot.background = element_rect(fill = NA, color = NA)
)
ggsave("/home/azermeno/dist_p_oc.png", plot = p_ocurrence, device = "png", bg = "transparent", width = 9, height = 4.5, units = "in")
p_ocurrence <- ggplot(motu_gcc, aes(x = pvalue_o)) +
geom_histogram(binwidth = 0.05, fill = "#b4d3e2") +
labs(
title = paste("Co-occurrence of mOTUs and GCCs"),
x = "p-value",
y = "Frequency"
) +
theme_minimal() +
theme(
legend.position = "none",
axis.title = element_text(size = 18),# Tamaño de la etiqueta del eje y
axis.text.x = element_text(size = 18),
axis.text.y = element_text(size = 18),
axis
panel.background = element_rect(fill = NA, color = NA),
ggsave("/home/azermeno/dist_p_oc.png", plot = p_ocurrence, device = "png", bg = "transparent", width = 9, height = 4.5, units = "in")
p_ocurrence <- ggplot(motu_gcc, aes(x = pvalue_o)) +
geom_histogram(binwidth = 0.05, fill = "#b4d3e2") +
labs(
title = paste("Co-occurrence of mOTUs and GCCs"),
x = "p-value",
y = "Frequency"
) +
theme_minimal() +
theme(
legend.position = "none",
axis.title.x = element_text(size = 18),# Tamaño de la etiqueta del eje y
axis.title.y = element_text(size = 18),
axis.text.x = element_text(size = 18),
axis.text.y = element_text(size = 18),
panel.background = element_rect(fill = NA, color = NA),
plot.background = element_rect(fill = NA, color = NA)
)
ggsave("/home/azermeno/dist_p_oc.png", plot = p_ocurrence, device = "png", bg = "transparent", width = 9, height = 4.5, units = "in")
p_exclusion <- ggplot(motu_gcc, aes(x = pvalue_e)) +
geom_histogram(binwidth = 0.05, fill = "#044a88") +
labs(
title = paste("Co-occurrence of mOTUs and GCCs"),
x = "p-value",
y = "Frequency"
) +
theme_minimal() +
theme(
legend.position = "none",
axis.title.x = element_text(size = 18),# Tamaño de la etiqueta del eje y
axis.title.y = element_text(size = 18),
axis.text.x = element_text(size = 18),
axis.text.y = element_text(size = 18),
panel.background = element_rect(fill = NA, color = NA),
plot.background = element_rect(fill = NA, color = NA)
)
ggsave("/home/azermeno/dist_p_ex.png", plot = p_exclusion, device = "png", bg = "transparent", width = 9, height = 4.5, units = "in")
setwd("~/MAGs_BGCs_interactions")
meta_mags <- read.csv("metadata.csv")
meta_bgcs <- read.csv("bgcs_metadata.csv")
View(meta_mags)
